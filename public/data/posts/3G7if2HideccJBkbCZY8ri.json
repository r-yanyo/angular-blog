{
  "id": "3G7if2HideccJBkbCZY8ri",
  "title": "Node.jsの標準モジュール(https)でAPIを叩く(GETのみ)",
  "date": "2018-02-10",
  "tags": [
    "JavaScript"
  ],
  "content": "<h3>(結構前にQiitaに上げた記事です。)</h3>\n<p>Node.jsを始めたばかりでAPIの叩き方が分からなかったのでメモ。<br>一般的にはrequestモジュールを使用するようですが、モジュール無しでサクッと書きたいことがあったので。</p>\n<p>APIを叩くテストとして「<a href=\"https://randomuser.me\">RANDOM USER GENERATOR</a>」を使用。<br>（このサービスはアプリケーションのテスト用に、適当なダミーユーザを作成するものらしいです。）</p>\n<h1>基本型</h1>\n<p>以下のようにhttps.requestの引数に直接URIを渡すと、自動的にhttpメソッドは&#39;GET&#39;になる。responseデータはres.onイベントで受け取る。最後にreq.end()を呼ばないと動かないので注意。</p>\n<pre><code class=\"language-js\">const https = require(&#39;https&#39;);\nconst req = https.request(&#39;URI&#39;, (res) =&gt; {\n　　　　　　　　res.on(&#39;data&#39;, (chunk) =&gt; {\n\n    ...\n\n    });\n\n    ....\n\n})\nreq.end();\n</code></pre>\n<h2>実装例</h2>\n<p>URI: <a href=\"https://randomuser.me/api/?inc=gender,name,nat&format=PrettyJSON\">https://randomuser.me/api/?inc=gender,name,nat&amp;format=PrettyJSON</a></p>\n<p>httpメソッド: &#39;GET&#39;</p>\n<p>query: inc=gender,name,nat&amp;format=PrettyJSON</p>\n<pre><code class=\"language-js\">const https = require(&#39;https&#39;);\n\nconst req = https.request(&#39;https://randomuser.me/api/?inc=gender,name,nat&amp;format=PrettyJSON&#39;, (res) =&gt; {\n    res.on(&#39;data&#39;, (chunk) =&gt; {\n        console.log(`BODY: ${chunk}`);\n    });\n    res.on(&#39;end&#39;, () =&gt; {\n        console.log(&#39;No more data in response.&#39;);\n    });\n})\n\nreq.on(&#39;error&#39;, (e) =&gt; {\n  console.error(`problem with request: ${e.message}`);\n});\n\nreq.end();\n</code></pre>\n<h2>結果</h2>\n<p>queryで指定した「gender」、「name」、「nat」プロパティだけを取得出来ている。</p>\n<pre><code>BODY: {\n  &quot;results&quot;: [\n    {\n      &quot;gender&quot;: &quot;female&quot;,\n      &quot;name&quot;: {\n        &quot;title&quot;: &quot;miss&quot;,\n        &quot;first&quot;: &quot;shivanie&quot;,\n        &quot;last&quot;: &quot;van kekem&quot;\n      },\n      &quot;nat&quot;: &quot;NL&quot;\n    }\n  ],\n  &quot;info&quot;: {\n    &quot;seed&quot;: &quot;cdac8f9044c4fe04&quot;,\n    &quot;results&quot;: 1,\n    &quot;page&quot;: 1,\n    &quot;version&quot;: &quot;1.1&quot;\n  }\n}\nNo more data in response.\n</code></pre>\n<h1>Optionsを使って書く</h1>\n<p>先程のようにURIを直接指定するのではなく、optionsに各要素を書くことも出来る。queryはpathに書く。<br>optionsの書き方は公式リファレンスに書いてある。(httpモジュールのリファレンスですが、多分httpsでもだいたい同じだと思う。。。）</p>\n<p><a href=\"https://nodejs.org/api/http.html#http_http_request_options_callback\">https://nodejs.org/api/http.html#http_http_request_options_callback</a></p>\n<pre><code class=\"language-js\">const https = require(&#39;https&#39;);\n\nconst options = {\n  protocol: &#39;PROTOCOL&#39;,\n  host: &#39;HOST&#39;,\n  path: &#39;PATH&#39;+&#39;QUERY&#39;,\n  method: &#39;METHOD&#39;,\n　　　　headers: {\n    &#39;Content-Type&#39;: &#39;CONTENT-TYPE&#39;\n  }\n};\n\nconst req = https.request(options, (res) =&gt; {\n　　　　　　　　res.on(&#39;data&#39;, (chunk) =&gt; {\n\n    ...\n\n    });\n\n    ....\n\n})\nreq.end();\n</code></pre>\n<h2>実装例</h2>\n<p>URI: <a href=\"https://randomuser.me/api/?inc=gender,name,nat&format=PrettyJSON\">https://randomuser.me/api/?inc=gender,name,nat&amp;format=PrettyJSON</a></p>\n<p>httpメソッド: &#39;GET&#39;</p>\n<p>query: inc=gender,name,nat&amp;format=PrettyJSON</p>\n<pre><code class=\"language-js\">const https = require(&#39;https&#39;);\n\nconst options = {\n  protocol: &#39;https:&#39;,\n  host: &#39;www.randomuser.me&#39;,\n  path: &#39;/api&#39;+&#39;?inc=gender,name,nat&amp;format=PrettyJSON&#39;,\n  method: &#39;GET&#39;,\n};\n\nconst req = https.request(options, (res) =&gt; {\n    res.on(&#39;data&#39;, (chunk) =&gt; {\n        console.log(`BODY: ${chunk}`);\n    });\n    res.on(&#39;end&#39;, () =&gt; {\n        console.log(&#39;No more data in response.&#39;);\n    });\n})\n\nreq.on(&#39;error&#39;, (e) =&gt; {\n  console.error(`problem with request: ${e.message}`);\n});\n\nreq.end();\n</code></pre>\n<h2>結果</h2>\n<pre><code>BODY: {\n  &quot;results&quot;: [\n    {\n      &quot;gender&quot;: &quot;female&quot;,\n      &quot;name&quot;: {\n        &quot;title&quot;: &quot;ms&quot;,\n        &quot;first&quot;: &quot;patricia&quot;,\n        &quot;last&quot;: &quot;evans&quot;\n      },\n      &quot;nat&quot;: &quot;GB&quot;\n    }\n  ],\n  &quot;info&quot;: {\n    &quot;seed&quot;: &quot;795d48206f63ba29&quot;,\n    &quot;results&quot;: 1,\n    &quot;page&quot;: 1,\n    &quot;version&quot;: &quot;1.1&quot;\n  }\n}\nNo more data in response.\n</code></pre>\n"
}